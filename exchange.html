<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Live Exchange | USD/GBP/EUR â€¢ Crypto to Naira | Larmah Enterprise</title>

  <meta name="description" content="Exchange USD, GBP, EUR and crypto (BTC, ETH, USDT) to NGN with WhatsApp-first support and fast settlement." />
  <meta name="theme-color" content="#070A12" />

  <link rel="icon" href="assets/images/larmah-favicon.jpeg" type="image/jpeg" />
  <link rel="preload" href="assets/images/larmah-header.jpeg" as="image" />

  <link rel="stylesheet" href="assets/css/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script defer src="assets/js/app.js"></script>
</head>

<body data-page="exchange">
  <div class="live-ticker">
    <div class="container">
      <div id="liveRatesTicker" class="ticker-content"><span>Loading live ratesâ€¦</span></div>
    </div>
  </div>

  <header>
    <div class="container header-inner">
      <a class="brand" href="index.html" aria-label="Larmah Home">
        <img src="assets/images/larmah-header.jpeg" alt="Larmah Enterprise" />
      </a>

      <button class="menu-btn" onclick="LARMAH.toggleMenu()" aria-label="Open menu">
        <i class="fa-solid fa-bars"></i>
      </button>

      <nav id="nav" aria-label="Primary navigation">
        <ul>
          <li><a class="nav-link" href="real-estate.html" data-link="real-estate">Real Estate</a></li>
          <li><a class="nav-link" href="logistics.html" data-link="logistics">Logistics</a></li>
          <li><a class="nav-link" href="insights.html" data-link="insights">Insights</a></li>
          <li><a class="nav-link" href="exchange.html" data-link="exchange">Exchange</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <div class="hero-shell">
        <div class="hero-inner">
          <div>
            <div class="hero-kicker">
              <span class="kicker-pill">
                <i class="fa-solid fa-money-bill-transfer"></i>
                Live Exchange Desk
              </span>
              <span class="kicker-dot">â€¢</span>
              <span class="kicker-sub">Fast settlement â€¢ WhatsApp-first support</span>
            </div>

            <h1>Exchange with Confidence.</h1>
            <p class="lead">
              Convert <b>USD, GBP, EUR</b> to NGN and trade <b>BTC, ETH, USDT</b> with a secure, verified workflow.
            </p>

            <div class="exchange-quick-calc">
              <div class="calc-inputs">
                <div class="input-group">
                  <input type="number" value="100" id="quickAmount" class="input" min="0" step="0.0001">
                  <select class="input" id="quickFrom">
                    <option value="USD">ðŸ‡ºðŸ‡¸ USD</option>
                    <option value="GBP">ðŸ‡¬ðŸ‡§ GBP</option>
                    <option value="EUR">ðŸ‡ªðŸ‡º EUR</option>
                    <option value="BTC">â‚¿ BTC</option>
                    <option value="ETH">Îž ETH</option>
                    <option value="USDT">ðŸ’µ USDT</option>
                  </select>
                </div>

                <div class="calc-arrow">â†’</div>

                <div class="input-group">
                  <div class="result-display" id="quickResult">â€”</div>
                  <select class="input" id="quickTo">
                    <option value="NGN">ðŸ‡³ðŸ‡¬ NGN</option>
                    <option value="USD">ðŸ‡ºðŸ‡¸ USD</option>
                    <option value="GBP">ðŸ‡¬ðŸ‡§ GBP</option>
                    <option value="EUR">ðŸ‡ªðŸ‡º EUR</option>
                    <option value="BTC">â‚¿ BTC</option>
                    <option value="ETH">Îž ETH</option>
                    <option value="USDT">ðŸ’µ USDT</option>
                  </select>
                </div>
              </div>

              <div class="actions" style="margin-top:12px">
                <button class="btn solid" onclick="quickExchange()">
                  <i class="fa-brands fa-whatsapp"></i> Get This Rate
                </button>
                <a class="btn" href="#calculator"><i class="fa-solid fa-calculator"></i> Advanced</a>
              </div>
            </div>

            <div class="trust-row">
              <div class="trust-badge"><i class="fa-solid fa-shield-halved"></i> Safer workflow</div>
              <div class="trust-badge"><i class="fa-solid fa-bolt"></i> Fast settlement</div>
              <div class="trust-badge"><i class="fa-solid fa-user-check"></i> Verified desk</div>
            </div>
          </div>

          <div class="hero-badges">
            <div class="hero-card">
              <h3><i class="fa-solid fa-dollar-sign" style="color:var(--brand)"></i> FX Desk</h3>
              <p>USD/GBP/EUR â†” NGN with WhatsApp-first coordination.</p>
              <div class="card-actions"><a class="btn small" href="#rates">View Rates</a></div>
            </div>
            <div class="hero-card">
              <h3><i class="fa-solid fa-coins" style="color:var(--brand)"></i> Crypto Desk</h3>
              <p>BTC/ETH/USDT â†” NGN with clear confirmation steps.</p>
              <div class="card-actions"><a class="btn small" href="#rates">Trade Crypto</a></div>
            </div>
            <div class="hero-card">
              <h3><i class="fa-solid fa-chart-line" style="color:var(--brand)"></i> Insights</h3>
              <p>See community updates and live signals.</p>
              <div class="card-actions"><a class="btn small" href="insights.html">Open Insights</a></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Rates -->
    <section class="section" id="rates">
      <div class="section-head-split">
        <div>
          <h2>Live Exchange Rates</h2>
          <p class="lead">Updates every minute (demo). Replace with real API anytime.</p>
        </div>
        <div class="notice" id="rateUpdateTime" style="max-width:max-content">Updated: â€”</div>
      </div>

      <div class="grid" id="forexRatesGrid"></div>

      <div class="section-head-split" style="margin-top:20px">
        <div>
          <h2>Crypto Rates</h2>
          <p class="lead">BTC â€¢ ETH â€¢ USDT</p>
        </div>
      </div>

      <div class="grid" id="cryptoRatesGrid"></div>
    </section>

    <!-- Calculator -->
    <section class="section" id="calculator">
      <div class="card">
        <h2><i class="fa-solid fa-calculator"></i> Advanced Exchange Calculator</h2>
        <p class="lead">Calculate estimated conversion and fee.</p>

        <div class="calc-container">
          <div class="calc-row">
            <div>
              <label class="small">You Send</label>
              <input type="number" class="input" id="sendAmount" value="100" min="0" step="0.0001">
            </div>
            <div>
              <label class="small">Currency</label>
              <select class="input" id="sendCurrency">
                <option value="USD">ðŸ‡ºðŸ‡¸ USD</option>
                <option value="GBP">ðŸ‡¬ðŸ‡§ GBP</option>
                <option value="EUR">ðŸ‡ªðŸ‡º EUR</option>
                <option value="BTC">â‚¿ BTC</option>
                <option value="ETH">Îž ETH</option>
                <option value="USDT">ðŸ’µ USDT</option>
                <option value="NGN">ðŸ‡³ðŸ‡¬ NGN</option>
              </select>
            </div>
          </div>

          <div class="calc-swap">
            <button class="swap-btn" onclick="swapCurrencies()">
              <i class="fa-solid fa-right-left"></i>
            </button>
          </div>

          <div class="calc-row">
            <div>
              <label class="small">You Receive</label>
              <div class="result-box" id="receiveAmount">â€”</div>
            </div>
            <div>
              <label class="small">Currency</label>
              <select class="input" id="receiveCurrency">
                <option value="NGN">ðŸ‡³ðŸ‡¬ NGN</option>
                <option value="USD">ðŸ‡ºðŸ‡¸ USD</option>
                <option value="GBP">ðŸ‡¬ðŸ‡§ GBP</option>
                <option value="EUR">ðŸ‡ªðŸ‡º EUR</option>
                <option value="BTC">â‚¿ BTC</option>
                <option value="ETH">Îž ETH</option>
                <option value="USDT">ðŸ’µ USDT</option>
              </select>
            </div>
          </div>

          <div class="calc-details">
            <div class="detail-row">
              <span>Rate:</span>
              <span id="calcRate">â€”</span>
            </div>
            <div class="detail-row">
              <span>Fee:</span>
              <span id="calcFee">â€”</span>
            </div>
            <div class="detail-row">
              <span>ETA:</span>
              <span id="calcTime">â€”</span>
            </div>
          </div>

          <button class="btn solid" style="width:100%;margin-top:14px" onclick="initiateExchange()">
            <i class="fa-brands fa-whatsapp"></i> Proceed with Exchange
          </button>
        </div>
      </div>
    </section>

    <!-- Form -->
    <section class="section" id="exchange-form">
      <div class="card">
        <h2>Start Exchange Now</h2>
        <p class="lead">Submit request â€” it logs to Supabase and opens WhatsApp.</p>

        <form id="exchangeRequestForm">
          <div class="row2">
            <div>
              <label class="small">Full Name *</label>
              <input type="text" class="input" id="exName" required />
            </div>
            <div>
              <label class="small">WhatsApp Number *</label>
              <input type="tel" class="input" id="exPhone" required />
            </div>
          </div>

          <div class="row2" style="margin-top:12px">
            <div>
              <label class="small">Exchange Type *</label>
              <select class="input" id="exType" required>
                <option value="">Select exchange type</option>
                <option value="USD to NGN">USD â†’ NGN</option>
                <option value="GBP to NGN">GBP â†’ NGN</option>
                <option value="EUR to NGN">EUR â†’ NGN</option>
                <option value="BTC to NGN">BTC â†’ NGN</option>
                <option value="ETH to NGN">ETH â†’ NGN</option>
                <option value="USDT to NGN">USDT â†’ NGN</option>
                <option value="NGN to USD">NGN â†’ USD</option>
                <option value="NGN to USDT">NGN â†’ USDT</option>
              </select>
            </div>
            <div>
              <label class="small">Amount *</label>
              <input type="number" class="input" id="exAmount" required min="0" step="0.0001" />
            </div>
          </div>

          <div style="margin-top:12px">
            <label class="small">Additional Notes</label>
            <textarea class="input" id="exNotes" rows="3" placeholder="Any special instructions..."></textarea>
          </div>

          <div class="actions" style="margin-top:12px">
            <button type="submit" class="btn solid" style="flex:1">
              <i class="fa-brands fa-whatsapp"></i> Submit Exchange Request
            </button>
          </div>
        </form>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <div class="footer-grid">
        <div>
          <div class="brandline">
            <img src="assets/images/larmah-header.jpeg" alt="Larmah Exchange" />
            <div>
              <div style="font-weight:950">Larmah Exchange Desk</div>
              <div class="small">USD/GBP/EUR â€¢ BTC/ETH/USDT</div>
            </div>
          </div>
          <div class="small" style="margin-top:8px">
            WhatsApp-first support and fast settlement coordination.
          </div>
        </div>

        <div>
          <b>Exchange</b>
          <div class="small" style="margin-top:10px"><a href="#rates">Live rates</a></div>
          <div class="small"><a href="#calculator">Calculator</a></div>
          <div class="small"><a href="#exchange-form">Start request</a></div>
        </div>

        <div>
          <b>Contact Desk</b>
          <div class="small" style="margin-top:10px"><i class="fa-brands fa-whatsapp"></i> +234 706 308 0605</div>
          <div class="small"><i class="fa-regular fa-envelope"></i> business@heylarmah.tech</div>
          <div class="small"><i class="fa-solid fa-clock"></i> 8AM â€“ 10PM daily</div>
        </div>
      </div>

      <div class="small">Â© <span id="year"></span> Larmah Enterprise.</div>
    </div>
  </footer>

  <div id="toast" class="toast"></div>

  <script>
    const EXCHANGE_CONFIG = {
      baseRates: {
        USD: { buy: 1450, sell: 1480, fee: 0.005, min: 100, max: 50000 },
        GBP: { buy: 1820, sell: 1850, fee: 0.005, min: 100, max: 30000 },
        EUR: { buy: 1580, sell: 1610, fee: 0.005, min: 100, max: 30000 },
        BTC: { buy: 85000000, sell: 87000000, fee: 0.01, min: 0.001, max: 5 },
        ETH: { buy: 4500000, sell: 4700000, fee: 0.01, min: 0.01, max: 50 },
        USDT:{ buy: 1470, sell: 1490, fee: 0.003, min: 10, max: 100000 }
      },
      updateInterval: 60000
    };

    class LarmahExchange {
      constructor(){
        this.base = JSON.parse(JSON.stringify(EXCHANGE_CONFIG.baseRates));
        this.rates = JSON.parse(JSON.stringify(EXCHANGE_CONFIG.baseRates));
        this.lastUpdate = new Date();
      }

      init(){
        this.updateLiveRates();
        this.renderRateCards();
        this.setupListeners();
        this.startUpdates();
        this.updateQuickCalc();
        this.updateAdvancedCalc();
      }

      startUpdates(){
        setInterval(() => {
          this.updateLiveRates();
          this.renderRateCards();
          this.updateQuickCalc();
          this.updateAdvancedCalc();
        }, EXCHANGE_CONFIG.updateInterval);
      }

      updateLiveRates(){
        Object.keys(this.rates).forEach(cur => {
          const drift = (Math.random() - 0.5) * 0.25;
          this.rates[cur].buy = this.rates[cur].buy * (1 + drift/100);
          this.rates[cur].sell = this.rates[cur].sell * (1 + drift/100);
        });

        this.lastUpdate = new Date();

        const t = document.getElementById("rateUpdateTime");
        if(t) t.textContent = "Updated: " + this.lastUpdate.toLocaleTimeString();

        const ticker = document.getElementById("liveRatesTicker");
        if(ticker){
          ticker.innerHTML = `
            <span>
              ðŸ“ˆ LIVE: USD/NGN â‚¦${this.rates.USD.buy.toFixed(2)} â€¢
              GBP/NGN â‚¦${this.rates.GBP.buy.toFixed(2)} â€¢
              EUR/NGN â‚¦${this.rates.EUR.buy.toFixed(2)} â€¢
              BTC/NGN â‚¦${(this.rates.BTC.buy/1e6).toFixed(1)}M
            </span>
          `;
        }
      }

      createRateCard(currency, label, isCrypto=false){
        const r = this.rates[currency];
        const base = this.base[currency].buy;
        const chg = ((r.buy - base) / base * 100);
        const up = chg >= 0;

        const minTxt = isCrypto ? `${r.min} ${currency}` : `$${r.min}`;
        const maxTxt = isCrypto ? `${r.max} ${currency}` : `$${Number(r.max).toLocaleString()}`;

        const price = (currency === "BTC" || currency === "ETH")
          ? `â‚¦${Math.round(r.buy).toLocaleString()}`
          : `â‚¦${r.buy.toFixed(2).toLocaleString()}`;

        return `
          <div class="card rate-card">
            ${isCrypto ? `<div class="rate-badge">CRYPTO</div>` : ``}
            <h3>${label}</h3>
            <div class="rate-main">${price}</div>
            <div class="meta" style="margin-top:6px">
              <span>Min: ${minTxt}</span>
              <span class="dot">â€¢</span>
              <span>Max: ${maxTxt}</span>
            </div>
            <div class="rate-change ${up ? "pos" : "neg"}">
              ${up ? "+" : ""}${chg.toFixed(2)}%
            </div>
            <div class="actions" style="margin-top:10px">
              <button class="btn small primary" onclick="exchange.selectRate('${currency}')">
                <i class="fa-brands fa-whatsapp"></i> Exchange ${currency}
              </button>
            </div>
          </div>
        `;
      }

      renderRateCards(){
        const forex = document.getElementById("forexRatesGrid");
        const crypto = document.getElementById("cryptoRatesGrid");

        if(forex){
          forex.innerHTML = `
            ${this.createRateCard("USD","ðŸ‡ºðŸ‡¸ US Dollar (USD)")}
            ${this.createRateCard("GBP","ðŸ‡¬ðŸ‡§ British Pound (GBP)")}
            ${this.createRateCard("EUR","ðŸ‡ªðŸ‡º Euro (EUR)")}
          `;
        }
        if(crypto){
          crypto.innerHTML = `
            ${this.createRateCard("BTC","â‚¿ Bitcoin (BTC)", true)}
            ${this.createRateCard("ETH","Îž Ethereum (ETH)", true)}
            ${this.createRateCard("USDT","ðŸ’µ Tether (USDT)", true)}
          `;
        }
      }

      selectRate(currency){
        const r = this.rates[currency];
        const msg = LARMAH.buildMessage("Exchange Quote Request", {
          "Pair": `${currency} â†’ NGN`,
          "Rate (Buy)": `â‚¦${(currency === "BTC" || currency === "ETH") ? Math.round(r.buy).toLocaleString() : r.buy.toFixed(2)}`,
          "Name": "",
          "Phone": ""
        });
        LARMAH.openWhatsApp(msg);
      }

      calculate(from, to, amount){
        const amt = Number(amount || 0);
        if(!amt) return { converted: 0, rate: 0, fee: 0, feePct: 0 };
        if(from === to) return { converted: amt, rate: 1, fee: 0, feePct: 0 };

        if(to === "NGN" && this.rates[from]){
          const rate = this.rates[from].buy;
          const feePct = this.rates[from].fee;
          const converted = amt * rate;
          const fee = converted * feePct;
          return { converted: converted - fee, rate, fee, feePct: feePct*100 };
        }

        if(from === "NGN" && this.rates[to]){
          const rate = 1 / this.rates[to].sell;
          const feePct = this.rates[to].fee;
          const converted = amt * rate;
          const fee = converted * feePct;
          return { converted: converted - fee, rate, fee, feePct: feePct*100 };
        }

        if(this.rates[from] && this.rates[to]){
          const toNgn = this.rates[from].buy;
          const ngnTo = 1 / this.rates[to].sell;
          const rate = toNgn * ngnTo;
          const feePct = Math.max(this.rates[from].fee, this.rates[to].fee);
          const converted = amt * rate;
          const fee = converted * feePct;
          return { converted: converted - fee, rate, fee, feePct: feePct*100 };
        }

        return { converted: 0, rate: 0, fee: 0, feePct: 0 };
      }

      format(amount, currency){
        const n = Number(amount || 0);
        if(currency === "NGN") return `â‚¦${n.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})}`;
        if(currency === "USD") return `$${n.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})}`;
        if(currency === "GBP" || currency === "EUR") return `${n.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})} ${currency}`;
        if(currency === "BTC") return `${n.toFixed(6)} BTC`;
        if(currency === "ETH") return `${n.toFixed(4)} ETH`;
        if(currency === "USDT") return `${n.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})} USDT`;
        return `${n.toLocaleString()} ${currency}`;
      }

      updateQuickCalc(){
        const amount = document.getElementById("quickAmount")?.value;
        const from = document.getElementById("quickFrom")?.value;
        const to = document.getElementById("quickTo")?.value;
        if(!from || !to) return;
        const res = this.calculate(from, to, amount);
        document.getElementById("quickResult").textContent = this.format(res.converted, to);
      }

      updateAdvancedCalc(){
        const amount = document.getElementById("sendAmount")?.value;
        const from = document.getElementById("sendCurrency")?.value;
        const to = document.getElementById("receiveCurrency")?.value;
        if(!from || !to) return;

        const res = this.calculate(from, to, amount);
        document.getElementById("receiveAmount").textContent = this.format(res.converted, to);
        document.getElementById("calcRate").textContent = `1 ${from} â‰ˆ ${this.format(res.rate, to)}`;
        document.getElementById("calcFee").textContent = `${res.feePct.toFixed(1)}% â€¢ ${this.format(res.fee, to)}`;

        const eta = (from === "BTC" || from === "ETH" || to === "BTC" || to === "ETH") ? "45â€“120 minutes" : "15â€“30 minutes";
        document.getElementById("calcTime").textContent = eta;
      }

      setupListeners(){
        ["quickAmount","quickFrom","quickTo"].forEach(id => {
          const el = document.getElementById(id);
          if(el) el.addEventListener("input", () => this.updateQuickCalc());
          if(el) el.addEventListener("change", () => this.updateQuickCalc());
        });

        ["sendAmount","sendCurrency","receiveCurrency"].forEach(id => {
          const el = document.getElementById(id);
          if(el) el.addEventListener("input", () => this.updateAdvancedCalc());
          if(el) el.addEventListener("change", () => this.updateAdvancedCalc());
        });

        const form = document.getElementById("exchangeRequestForm");
        if(form){
          form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const name = document.getElementById("exName").value.trim();
            const phone = document.getElementById("exPhone").value.trim();
            const type = document.getElementById("exType").value.trim();
            const amount = document.getElementById("exAmount").value.trim();
            const notes = document.getElementById("exNotes").value.trim();

            if(!name || !phone || !type || !amount){
              LARMAH.toast("Please fill all required fields");
              return;
            }

            const fields = { Name: name, Phone: phone, Exchange: type, Amount: amount, Notes: notes || "-" };

            const res = await LARMAH.submitRequest({ category: "exchange", name, phone, details: fields });
            if(!res.ok) LARMAH.toast("Logging request...");

            LARMAH.openWhatsApp(LARMAH.buildMessage("Exchange Request", fields));
            form.reset();
            LARMAH.toast("Opening WhatsAppâ€¦");
          });
        }
      }
    }

    function swapCurrencies(){
      const from = document.getElementById("sendCurrency");
      const to = document.getElementById("receiveCurrency");
      const tmp = from.value;
      from.value = to.value;
      to.value = tmp;
      exchange.updateAdvancedCalc();
    }

    function quickExchange(){
      const amount = document.getElementById("quickAmount").value;
      const from = document.getElementById("quickFrom").value;
      const to = document.getElementById("quickTo").value;
      const result = document.getElementById("quickResult").textContent;

      const msg = LARMAH.buildMessage("Quick Exchange Quote", {
        "From": `${amount} ${from}`,
        "To": `${to}`,
        "Expected": result,
        "Name": "",
        "Phone": ""
      });

      LARMAH.openWhatsApp(msg);
    }

    function initiateExchange(){
      const amount = document.getElementById("sendAmount").value;
      const from = document.getElementById("sendCurrency").value;
      const to = document.getElementById("receiveCurrency").value;
      const receive = document.getElementById("receiveAmount").textContent;
      const rate = document.getElementById("calcRate").textContent;

      const msg = LARMAH.buildMessage("Exchange Initiation", {
        "Send": `${amount} ${from}`,
        "Receive": `${receive} (${to})`,
        "Rate": rate,
        "Name": "",
        "Phone": ""
      });

      LARMAH.openWhatsApp(msg);
    }

    document.addEventListener("DOMContentLoaded", () => {
      window.exchange = new LarmahExchange();
      exchange.init();
    });
  </script>
</body>
</html>
