<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sign in | Larmah</title>
<link rel="icon" href="assets/images/larmah-favicon.jpeg" type="image/jpeg"/>
<meta name="description" content="Secure sign in with Supabase: password or magic link."/>
<link rel="stylesheet" href="assets/css/style.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script defer src="assets/js/app.js"></script>

</head>
<body data-page="auth">
<header>
  <div class="container header-inner">
    <a class="brand" href="index.html" aria-label="Home">
      <img src="assets/images/larmah-header.jpeg" alt="Larmah"/>
    </a>

    <button class="menu-btn" onclick="LARMAH.toggleMenu()" aria-label="Menu">
      <i class="fa-solid fa-bars"></i>
    </button>

    <nav id="nav" aria-label="Navigation">
      <ul>
        <li><a class="nav-link" href="real-estate.html" data-link="real-estate">Real Estate</a></li>
        <li><a class="nav-link" href="logistics.html" data-link="logistics">Logistics</a></li>
        <li><a class="nav-link" href="fintech.html" data-link="fintech">FinTech</a></li>
        <li><a class="nav-link" href="insights.html" data-link="insights">Insights</a></li>
      </ul>
    </nav>

    <div class="header-actions" id="authPill">
      <a class="pill primary" href="premium.html"><i class="fa-solid fa-star"></i> Premium</a>
    </div>
  </div>
</header>
<main class="container">

  <section class="hero">
    <div class="hero-shell">
      <div class="hero-inner" style="grid-template-columns:1fr;">
        <div>
          <h1>Sign in</h1>
          <p>Use email + password or request a magic link. Powered by Supabase Auth.</p>
        </div>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="grid">
      <div class="card">
        <h3>Email + Password</h3>
        <div class="row2" style="margin-top:12px;">
          <input id="email" class="input" type="email" placeholder="Email"/>
          <input id="password" class="input" type="password" placeholder="Password"/>
        </div>
        <div class="actions" style="margin-top:12px;">
          <button class="btn solid" onclick="signIn()"><i class="fa-solid fa-right-to-bracket"></i> Sign in</button>
          <button class="btn" onclick="signUp()"><i class="fa-solid fa-user-plus"></i> Sign up</button>
        </div>
        <div class="small" style="margin-top:10px;">Admin role is assigned in the database (profiles.role).</div>
      </div>

      <div class="card">
        <h3>Magic link</h3>
        <p class="small">We send a login link to your email.</p>
        <input id="otpEmail" class="input" type="email" placeholder="Email" style="margin-top:12px;"/>
        <div class="actions" style="margin-top:12px;">
          <button class="btn solid" onclick="magicLink()"><i class="fa-solid fa-envelope"></i> Send link</button>
          <button class="btn" onclick="resetPassword()"><i class="fa-solid fa-key"></i> Reset password</button>
        </div>
        <div class="notice" style="margin-top:12px;">
          <strong>Tip:</strong> Configure Auth redirect URLs in Supabase to your domain.
        </div>
      </div>
    </div>
  </section>

</main>
<footer>
  <div class="container">
    <div class="footer-grid">
      <div>
        <div class="brandline">
          <img src="assets/images/larmah-header.jpeg" alt="Larmah"/>
        </div>
        <div class="small">Real Estate • Logistics • FinTech • Insights</div>
        <div class="small" style="margin-top:8px;">WhatsApp-first support for Nigeria community.</div>
      </div>

      <div>
        <b>Contact</b>
        <div class="small" style="margin-top:8px;">WhatsApp: +234 706 308 0605</div>
        <div class="small">Email: business@heylarmah.tech</div>
        <div class="small">Lagos, Nigeria</div>
      </div>

      <div>
        <b>Admin</b>
        <div class="small" style="margin-top:8px;"><a href="auth.html">Sign in</a></div>
        <div class="small"><a href="admin.html">Command Center</a></div>
      </div>
    </div>

    <div class="small">© <span id="year"></span> Larmah Enterprise.</div>
  </div>
</footer>
<div id="toast" class="toast"></div>
<script>
async function signIn(){
  const sb = await LARMAH.initSupabase();
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  if(!email || !password){ LARMAH.toast("Enter email and password"); return; }
  const r = await sb.auth.signInWithPassword({ email: email, password: password });
  if(r.error){ LARMAH.toast(r.error.message); return; }
  LARMAH.toast("Signed in");
  setTimeout(()=> location.href="index.html", 600);
}

async function signUp(){
  const sb = await LARMAH.initSupabase();
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  if(!email || !password){ LARMAH.toast("Enter email and password"); return; }
  const r = await sb.auth.signUp({ email: email, password: password });
  if(r.error){ LARMAH.toast(r.error.message); return; }
  LARMAH.toast("Check your email to confirm");
}

async function magicLink(){
  const sb = await LARMAH.initSupabase();
  const email = document.getElementById("otpEmail").value.trim();
  if(!email){ LARMAH.toast("Enter email"); return; }
  const r = await sb.auth.signInWithOtp({
    email: email,
    options: { emailRedirectTo: window.location.origin + "/index.html" }
  });
  if(r.error){ LARMAH.toast(r.error.message); return; }
  LARMAH.toast("Link sent. Check email.");
}

async function resetPassword(){
  const sb = await LARMAH.initSupabase();
  const email = document.getElementById("otpEmail").value.trim();
  if(!email){ LARMAH.toast("Enter email"); return; }
  const r = await sb.auth.resetPasswordForEmail(email, { redirectTo: window.location.origin + "/auth.html" });
  if(r.error){ LARMAH.toast(r.error.message); return; }
  LARMAH.toast("Password reset email sent");
}
</script>
</body>
</html>
