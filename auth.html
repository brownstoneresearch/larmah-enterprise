<!DOCTYPE html>
<html lang="en-NG" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="robots" content="index,follow" />

  <title>Access | Larmah Enterprise</title>
  <meta name="description" content="Premium members only: sign in to access your Larmah dashboard. New accounts are created after Premium payment verification." />
  <meta name="theme-color" content="#070A12" />
  <meta name="color-scheme" content="dark light" />
  <link rel="canonical" href="https://heylarmah.tech/auth.html" />

  <meta property="og:type" content="website" />
  <meta property="og:locale" content="en_NG" />
  <meta property="og:url" content="https://heylarmah.tech/auth.html" />
  <meta property="og:title" content="Larmah Access | Premium Members" />
  <meta property="og:description" content="Premium members only: sign in to access your Larmah dashboard." />
  <meta property="og:image" content="https://heylarmah.tech/assets/images/larmah-header.jpeg" />

  <link rel="icon" href="assets/images/larmah-favicon.jpeg" type="image/jpeg" />
  <link rel="apple-touch-icon" href="assets/images/larmah-favicon.jpeg" />

  <link rel="preload" href="assets/images/larmah-favicon.jpeg" as="image" fetchpriority="high" />
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin />
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script defer src="assets/js/app.js"></script>

  <style>
    :root{
      --gold:#D4AF37; --gold2:#F5D57A;
      --radius: 18px; --radius2: 22px; --max: 1120px;
      --ease: cubic-bezier(.2,.8,.2,1);
      --shadow: 0 18px 50px rgba(0,0,0,.42);
      --shadow2: 0 12px 34px rgba(0,0,0,.30);
    }
    html[data-theme="dark"]{
      --bg:#070A12; --bg2:#050810;
      --panel: rgba(255,255,255,.03);
      --panel2: rgba(255,255,255,.02);
      --line: rgba(255,255,255,.10);
      --line2: rgba(255,255,255,.08);
      --text:#E9EDF7;
      --muted: rgba(233,237,247,.72);
      --muted2: rgba(233,237,247,.60);
      --headerBg: rgba(7,10,18,.72);
      --overlayBg: rgba(0,0,0,.55);
      --ctaBg: rgba(0,0,0,.28);
      --ctaLine: rgba(255,255,255,.12);
      --good: rgba(0,217,129,.95);
      --bad: rgba(255,90,103,.95);
      --logoGlow: 0 0 22px rgba(212,175,55,.14);
      --logoRing: rgba(255,255,255,.12);
      --logoBg: rgba(255,255,255,.03);
    }
    html[data-theme="light"]{
      --bg:#F7F7FB; --bg2:#FFFFFF;
      --panel: rgba(10,14,26,.04);
      --panel2: rgba(10,14,26,.03);
      --line: rgba(10,14,26,.12);
      --line2: rgba(10,14,26,.08);
      --text:#0E1526;
      --muted: rgba(14,21,38,.68);
      --muted2: rgba(14,21,38,.56);
      --headerBg: rgba(255,255,255,.78);
      --overlayBg: rgba(0,0,0,.40);
      --ctaBg: rgba(255,255,255,.78);
      --ctaLine: rgba(10,14,26,.10);
      --good: rgba(0,140,90,.92);
      --bad: rgba(200,34,60,.90);
      --shadow: 0 16px 46px rgba(0,0,0,.12);
      --shadow2: 0 10px 26px rgba(0,0,0,.10);
      --logoGlow: 0 0 0 rgba(0,0,0,0);
      --logoRing: rgba(10,14,26,.10);
      --logoBg: rgba(255,255,255,.65);
    }

    *{ box-sizing:border-box; }
    html{ scroll-behavior:smooth; }
    @media (prefers-reduced-motion: reduce){
      html{ scroll-behavior:auto; }
      *{ animation:none !important; transition:none !important; }
    }

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:
        radial-gradient(900px 420px at 18% 6%, rgba(212,175,55,.10), transparent 60%),
        radial-gradient(900px 420px at 85% 10%, rgba(0,217,129,.06), transparent 62%),
        radial-gradient(900px 520px at 50% 110%, rgba(0,122,255,.06), transparent 58%),
        linear-gradient(180deg, var(--bg2), var(--bg));
      color: var(--text);
      overflow-x:hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    a{ color: var(--text); text-decoration:none; }
    a:hover{ color: var(--gold); }
    .container{ max-width: var(--max); margin: 0 auto; padding: 0 16px; }

    header{
      position:sticky; top:0; z-index:50;
      background: var(--headerBg);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--line2);
    }
    .header-inner{ display:flex; align-items:center; gap:12px; padding: 12px 0; }
    .brand{ display:flex; align-items:center; gap:10px; min-width: 220px; }

    .logo-wrap{
      position:relative;
      width:44px; height:44px;
      border-radius: 14px;
      padding: 2px;
      background:
        radial-gradient(18px 18px at 25% 20%, rgba(245,213,122,.35), transparent 70%),
        radial-gradient(20px 20px at 85% 80%, rgba(212,175,55,.22), transparent 70%),
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.02));
      box-shadow: var(--logoGlow);
      border: 1px solid var(--logoRing);
      flex: 0 0 auto;
      isolation:isolate;
    }
    .logo-wrap::after{
      content:"";
      position:absolute;
      inset:-10px;
      background: radial-gradient(16px 16px at 50% 50%, rgba(212,175,55,.10), transparent 70%);
      filter: blur(12px);
      opacity:.8;
      pointer-events:none;
      z-index:-1;
    }
    .logo-wrap img{
      width:100%; height:100%;
      object-fit: cover;
      display:block;
      border-radius: 12px;
      border: 1px solid var(--line2);
      background: var(--logoBg);
    }
    .brand .btxt{ display:flex; flex-direction:column; line-height:1.05; gap:4px; min-width:0; }
    .brand .bname{ font-weight: 950; letter-spacing:-0.2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .brand .bsub{ font-size:.86rem; color: var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    nav{ margin-left:auto; }
    nav ul{ display:flex; list-style:none; gap:18px; padding:0; margin:0; align-items:center; }
    .nav-link{ color: var(--text); opacity:.9; font-weight: 850; font-size: .95rem; position:relative; }
    .nav-link:hover{ color: var(--gold); opacity:1; }
    .nav-link.active{ color: var(--gold); opacity:1; }
    .nav-link.active::after{
      content:""; position:absolute; left:0; right:0; bottom:-12px; height:2px;
      background: rgba(212,175,55,.65); border-radius:999px;
    }

    .header-actions{ display:flex; gap:10px; align-items:center; margin-left: 10px; }
    .icon-btn{
      width: 42px; height: 42px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: var(--panel);
      color: var(--text);
      display:inline-flex; align-items:center; justify-content:center;
      cursor:pointer;
      transition: transform .16s var(--ease), filter .16s var(--ease);
    }
    .icon-btn:hover{ transform: translateY(-1px); filter: brightness(1.05); }

    .menu-btn{
      display:none;
      border: 1px solid var(--line);
      background: var(--panel);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 12px;
      cursor:pointer;
    }
    @media (max-width: 980px){
      nav{ display:none; }
      .menu-btn{ display:inline-flex; align-items:center; justify-content:center; }
      .header-actions{ margin-left:auto; }
    }

    .overlay{ position:fixed; inset:0; background: var(--overlayBg); display:none; align-items:flex-end; z-index:80; }
    .overlay.open{ display:flex; }
    .sheet{
      width:100%;
      border-radius: 18px 18px 0 0;
      border: 1px solid var(--line);
      background: color-mix(in oklab, var(--bg2) 82%, #000 18%);
      box-shadow: var(--shadow);
      padding: 14px;
    }
    .sheet-head{
      display:flex; align-items:center; justify-content:space-between;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--line2);
      margin-bottom: 10px;
      gap: 10px;
    }
    .sheet-brandline{ display:flex; align-items:center; gap:10px; min-width:0; }
    .sheet a{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid var(--line2);
      background: var(--panel2);
      color: var(--text);
      margin-bottom: 10px;
      font-weight: 900;
    }
    .sheet-actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 8px; }

    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      border-radius: 14px; padding: 12px 16px; min-height: 46px;
      border: 1px solid var(--line);
      background: var(--panel);
      color: var(--text);
      cursor:pointer;
      font-weight: 950;
      transition: transform .16s var(--ease), filter .16s var(--ease), background .16s var(--ease);
      white-space:nowrap;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); filter: brightness(1.03); }
    .btn:active{ transform: translateY(0); }
    .btn.solid{ background: var(--gold); color:#111; border-color: color-mix(in oklab, var(--gold) 55%, #000 45%); }
    .btn.primary{ background: var(--panel2); border-color: var(--line); }
    .btn.small{ min-height: 40px; padding: 10px 12px; border-radius: 12px; font-weight: 900; }
    .btn:disabled{ opacity:.6; cursor:not-allowed; transform:none !important; filter:none !important; }

    .page-wrap{ padding: 18px 0 0; }

    /* Auth layout (premium style) */
    .auth-wrap{ max-width: 1120px; margin: 18px auto 70px; padding: 0 16px; }
    .auth-grid{ display:grid; grid-template-columns: 1.1fr .9fr; gap: 14px; align-items:stretch; }
    @media(max-width: 980px){ .auth-grid{ grid-template-columns: 1fr; } }

    .auth-visual{
      border-radius: var(--radius2);
      border: 1px solid var(--line);
      background:
        linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.14)),
        url('assets/images/larmah-header.jpeg') center/cover no-repeat;
      min-height: 380px;
      padding: 18px;
      display:flex;
      align-items:flex-end;
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
      isolation:isolate;
    }
    .auth-visual::after{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(900px 420px at 15% 0%, rgba(212,175,55,.18), transparent 55%);
      pointer-events:none;
      z-index:0;
    }
    .auth-visual > div{ position:relative; z-index:1; }
    .auth-visual .kicker{
      display:inline-flex; align-items:center; gap:10px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.28);
      backdrop-filter: blur(8px);
      font-weight: 950;
      color: rgba(233,237,247,.92);
    }
    html[data-theme="light"] .auth-visual .kicker{
      border-color: rgba(10,14,26,.12);
      background: rgba(255,255,255,.72);
      color: rgba(14,21,38,.90);
    }

    .auth-card{
      border-radius: var(--radius2);
      border: 1px solid var(--line);
      background:
        radial-gradient(900px 420px at 15% 0%, rgba(212,175,55,.12), transparent 55%),
        radial-gradient(900px 420px at 85% 20%, rgba(0,217,129,.08), transparent 60%),
        var(--panel2);
      box-shadow: var(--shadow);
      overflow:hidden;
      padding: 16px;
    }
    .auth-tabs{ display:flex; gap: 14px; border-bottom: 1px solid var(--line2); padding-bottom: 10px; margin-bottom: 14px; }
    .auth-tab{ font-weight: 950; color: var(--muted); cursor:pointer; user-select:none; }
    .auth-tab.active{ color: var(--text); border-bottom: 2px solid rgba(212,175,55,.65); padding-bottom: 10px; }
    .divider{ display:flex; align-items:center; gap:10px; color: var(--muted2); font-size:.8rem; margin: 14px 0; }
    .divider::before, .divider::after{ content:""; flex:1; height:1px; background: var(--line2); }
    .hint{ font-size:.9rem; color: var(--muted); margin-top:10px; line-height:1.5; }

    .field{ display:flex; flex-direction:column; gap:6px; margin-bottom: 12px; }
    label.small{
      font-size:.78rem;
      letter-spacing:.12em;
      text-transform: uppercase;
      color: var(--muted2);
      font-weight: 850;
    }
    .input{
      border-radius: 14px;
      border: 1px solid var(--line);
      background: var(--panel);
      color: var(--text);
      padding: 12px 12px;
      min-height: 46px;
      outline:none;
      font-family: inherit;
    }

    .notice{
      border-radius: 16px;
      padding: 12px;
      border: 1px solid var(--line);
      background: var(--panel2);
      color: var(--muted);
    }
    .notice strong{ color: var(--text); }

    footer{
      margin-top: 18px;
      border-top: 1px solid var(--line);
      background: color-mix(in oklab, var(--bg2) 80%, #000 20%);
    }
    .footer-grid{ display:grid; gap: 16px; padding: 16px 0; grid-template-columns: 1.35fr 1fr 1fr; }
    @media (max-width: 980px){ .footer-grid{ grid-template-columns: 1fr; } }
    .footer-col-title{ font-weight: 950; margin: 0 0 10px; letter-spacing: -0.2px; }
    .footer-links a{ display:block; padding: 6px 0; color: color-mix(in oklab, var(--text) 84%, transparent); font-weight: 600; }
    .footer-links a:hover{ color: var(--gold); }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      min-width: 220px;
      max-width: min(560px, calc(100vw - 28px));
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: color-mix(in oklab, var(--bg2) 88%, #000 12%);
      box-shadow: var(--shadow2);
      color: var(--text);
      display:none;
      z-index: 120;
    }
    .toast.show{ display:block; }
  </style>
</head>

<body data-page="auth">
  <!-- Mobile nav -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="sheet" role="dialog" aria-label="Menu">
      <div class="sheet-head">
        <div class="sheet-brandline">
          <div class="logo-wrap" aria-hidden="true">
            <img src="assets/images/larmah-favicon.jpeg" alt="Larmah Enterprise" />
          </div>
          <div style="min-width:0">
            <div style="font-weight:950; line-height:1.1">Larmah Enterprise</div>
            <div style="color:var(--muted); font-weight:850; font-size:.92rem; margin-top:4px;">Real Estate • Logistics</div>
          </div>
        </div>
        <button class="icon-btn" type="button" onclick="toggleMenu(false)" aria-label="Close menu">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>

      <a href="index.html#about"><span><i class="fa-solid fa-circle-info" style="color:var(--gold)"></i> About</span><i class="fa-solid fa-chevron-right" style="opacity:.6"></i></a>
      <a href="real-estate.html"><span><i class="fa-solid fa-building" style="color:var(--gold)"></i> Real Estate</span><i class="fa-solid fa-chevron-right" style="opacity:.6"></i></a>
      <a href="logistics.html"><span><i class="fa-solid fa-truck-fast" style="color:var(--gold)"></i> Logistics</span><i class="fa-solid fa-chevron-right" style="opacity:.6"></i></a>
      <a href="premium.html"><span><i class="fa-solid fa-crown" style="color:var(--gold)"></i> Premium</span><i class="fa-solid fa-chevron-right" style="opacity:.6"></i></a>

      <div class="sheet-actions">
        <button class="btn primary" type="button" onclick="toggleTheme()" aria-label="Toggle theme">
          <i class="fa-solid fa-circle-half-stroke"></i> Toggle Theme
        </button>
      </div>
    </div>
  </div>

  <header>
    <div class="container header-inner">
      <a class="brand" href="index.html#home" aria-label="Back to Index">
        <div class="logo-wrap" aria-hidden="true">
          <img src="assets/images/larmah-favicon.jpeg" alt="Larmah Enterprise" />
        </div>
        <div class="btxt">
          <div class="bname">Larmah Enterprise</div>
          <div class="bsub">Real Estate • Logistics</div>
        </div>
      </a>

      <nav aria-label="Primary navigation">
        <ul>
          <li><a class="nav-link" href="index.html#about">About</a></li>
          <li><a class="nav-link" href="real-estate.html">Real Estate</a></li>
          <li><a class="nav-link" href="logistics.html">Logistics</a></li>
          <li><a class="nav-link" href="premium.html">Premium</a></li>
          <li><a class="nav-link active" href="auth.html">Access</a></li>
        </ul>
      </nav>

      <div class="header-actions">
        <button class="icon-btn" type="button" onclick="toggleTheme()" aria-label="Toggle theme" title="Toggle theme">
          <i class="fa-solid fa-circle-half-stroke"></i>
        </button>
        <button class="menu-btn" type="button" onclick="toggleMenu(true)" aria-label="Open menu">
          <i class="fa-solid fa-bars"></i>
        </button>
      </div>
    </div>
  </header>

  <main class="auth-wrap" id="main" tabindex="-1">
    <div class="auth-grid">
      <section class="auth-visual" aria-label="Access hero">
        <div>
          <div class="kicker"><i class="fa-solid fa-shield-halved"></i> Secure Access</div>
          <h1 style="margin:12px 0 10px; letter-spacing:-0.6px;">Premium Members Only.</h1>
          <p class="lead" style="max-width: 560px; color:rgba(233,237,247,.88); margin:0;">
            Accounts are issued after Premium payment verification.
            If you haven’t subscribed yet, go Premium to unlock access.
          </p>

          <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;">
            <a class="btn solid" href="premium.html#pay"><i class="fa-solid fa-credit-card"></i> Go Premium</a>
            <button class="btn primary" type="button" onclick="supportAuth()"><i class="fa-brands fa-whatsapp"></i> WhatsApp Support</button>
          </div>

          <div class="notice" style="margin-top:14px; max-width: 620px;">
            <strong>Note:</strong> If you already paid, please sign in with the email used for payment.
            If access isn’t active yet, share your Paystack reference on WhatsApp for fast verification.
          </div>
        </div>
      </section>

      <section class="auth-card" aria-label="Sign in">
        <div class="auth-tabs">
          <div class="auth-tab active" id="tabLogin">Sign In</div>
          <div class="auth-tab" id="tabRegister">Create Account</div>
        </div>

        <!-- LOGIN -->
        <form id="loginForm" autocomplete="on">
          <div class="field">
            <label class="small" for="loginEmail">Email Address</label>
            <input type="email" id="loginEmail" class="input" placeholder="name@example.com" autocomplete="email" required>
          </div>

          <div class="field" style="margin-bottom:14px;">
            <label class="small" for="loginPassword">Password</label>
            <input type="password" id="loginPassword" class="input" placeholder="••••••••" autocomplete="current-password" required>
          </div>

          <button type="submit" class="btn solid" style="width:100%" id="loginBtn">
            Sign In
          </button>

          <button type="button" class="btn primary" style="width:100%; margin-top:10px" id="resetBtn">
            <i class="fa-solid fa-key"></i> Reset Password
          </button>

          <button type="button" class="btn" style="width:100%; margin-top:10px" id="resendBtn">
            <i class="fa-regular fa-envelope"></i> Resend Verification Email
          </button>

          <div class="hint">
            If your email isn’t verified yet, open your inbox and click the verification link first.
            Premium access is enforced at sign-in (non-premium accounts are blocked).
          </div>
        </form>

        <!-- REGISTER (Premium-only; shown but gated) -->
        <form id="registerForm" style="display:none" autocomplete="on">
          <div class="notice">
            <strong>Premium-only:</strong> New accounts are created after Premium payment verification.
            If you’ve already paid, use the same email here and we’ll verify it quickly on WhatsApp.
          </div>

          <div class="field" style="margin-top:12px;">
            <label class="small" for="regName">Full Name</label>
            <input type="text" id="regName" class="input" placeholder="e.g. John Doe" autocomplete="name">
          </div>

          <div class="field">
            <label class="small" for="regEmail">Email Address</label>
            <input type="email" id="regEmail" class="input" placeholder="name@example.com" autocomplete="email">
          </div>

          <div class="field" style="margin-bottom:14px;">
            <label class="small" for="regPassword">Password</label>
            <input type="password" id="regPassword" class="input" placeholder="Create a strong password" autocomplete="new-password">
          </div>

          <button type="button" class="btn solid" style="width:100%" onclick="goPremium()">
            <i class="fa-solid fa-crown"></i> Go Premium to Create Account
          </button>

          <button type="button" class="btn primary" style="width:100%; margin-top:10px" onclick="supportAuth()">
            <i class="fa-brands fa-whatsapp"></i> Verify Payment / Request Access
          </button>

          <div class="hint">
            After Premium verification, we enable your account and you can sign in immediately.
          </div>
        </form>

        <div class="divider">NEED HELP?</div>
        <button class="btn" style="width:100%" type="button" onclick="supportAuth()">
          <i class="fa-brands fa-whatsapp"></i> WhatsApp Support
        </button>
      </section>
    </div>
  </main>

  <footer>
    <div class="container">
      <div class="footer-grid">
        <div>
          <div class="brandline">
            <div class="logo-wrap" aria-hidden="true">
              <img src="assets/images/larmah-favicon.jpeg" alt="Larmah Enterprise" />
            </div>
            <div>
              <div style="font-weight:950">Larmah Enterprise</div>
              <div style="color:var(--muted2); font-weight:850; margin-top:4px;">RC: 9127113</div>
            </div>
          </div>
          <div style="margin-top:10px; color:var(--muted); line-height:1.55;">
            Verified real estate and trusted logistics across Nigeria — WhatsApp-first support.
          </div>
        </div>

        <div>
          <div class="footer-col-title">Quick Links</div>
          <div class="footer-links">
            <a href="index.html#about">About</a>
            <a href="real-estate.html">Real Estate</a>
            <a href="logistics.html">Logistics</a>
            <a href="premium.html">Premium</a>
            <a href="auth.html">Access</a>
          </div>
        </div>

        <div>
          <div class="footer-col-title">Contact</div>
          <div style="display:grid; gap:10px;">
            <div class="contact-chip">
              <i class="fa-brands fa-whatsapp"></i>
              <div>
                <div class="txt">+234 706 308 0605</div>
                <div class="sub">WhatsApp-first support</div>
              </div>
            </div>
            <div class="contact-chip">
              <i class="fa-regular fa-envelope"></i>
              <div>
                <div class="txt"><a href="mailto:business@heylarmah.tech">business@heylarmah.tech</a></div>
                <div class="sub">Business enquiries</div>
              </div>
            </div>
            <div class="contact-chip">
              <i class="fa-solid fa-location-dot"></i>
              <div>
                <div class="txt">Lagos, Nigeria</div>
                <div class="sub">Serving Nigeria nationwide</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div style="border-top:1px solid var(--line2); padding:12px 0 16px; color:var(--muted2); font-size:.9rem; display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;">
        <div>© <span id="year"></span> Larmah Enterprise. All rights reserved.</div>
      </div>
    </div>
  </footer>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    // ===== basics
    document.getElementById("year").textContent = new Date().getFullYear();
    const reduceMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

    function toast(msg){
      const t = document.getElementById("toast");
      if(!t) return;
      t.textContent = msg;
      t.classList.add("show");
      clearTimeout(window.__toastT);
      window.__toastT = setTimeout(() => t.classList.remove("show"), 2400);
    }

    // ===== theme (SAME AS premium/index)
    const THEME_KEY = "larmah_theme_v5";
    function setTheme(theme){
      document.documentElement.setAttribute("data-theme", theme);
      localStorage.setItem(THEME_KEY, theme);
      const metaTheme = document.querySelector('meta[name="theme-color"]');
      if(metaTheme) metaTheme.setAttribute("content", theme === "light" ? "#F7F7FB" : "#070A12");
    }
    function toggleTheme(){
      const cur = document.documentElement.getAttribute("data-theme") || "dark";
      setTheme(cur === "dark" ? "light" : "dark");
    }
    (function initTheme(){
      const saved = localStorage.getItem(THEME_KEY);
      if(saved === "light" || saved === "dark"){ setTheme(saved); return; }
      const prefersLight = window.matchMedia && window.matchMedia("(prefers-color-scheme: light)").matches;
      setTheme(prefersLight ? "light" : "dark");
    })();

    // ===== mobile menu
    const overlay = document.getElementById("overlay");
    function toggleMenu(open){
      overlay.classList.toggle("open", !!open);
      overlay.setAttribute("aria-hidden", open ? "false" : "true");
    }
    overlay.addEventListener("click", (e) => { if(e.target === overlay) toggleMenu(false); });

    // ===== WA helpers (prefer app.js global)
    function buildMsg(title, data){
      if(window.LARMAH?.buildMessage) return LARMAH.buildMessage(title, data);
      const lines = [title, ""];
      for(const [k,v] of Object.entries(data || {})){
        const val = (v ?? "").toString().trim();
        if(val) lines.push(`${k}: ${val}`);
      }
      return lines.join("\n");
    }
    function openWA(text){
      if(window.LARMAH?.openWhatsApp) return LARMAH.openWhatsApp(text);
      const phone = "2347063080605";
      window.open(`https://wa.me/${phone}?text=${encodeURIComponent(text)}`, "_blank", "noopener,noreferrer");
    }

    function supportAuth(){
      openWA(buildMsg("Access Support", {
        Page: "auth.html",
        Message: "Hello Larmah, I need help with Premium access / account activation. My email is: "
      }));
    }
    window.supportAuth = supportAuth;

    function goPremium(){
      window.location.href = "premium.html#pay";
    }
    window.goPremium = goPremium;

    // ===== tabs
    const tabLogin = document.getElementById("tabLogin");
    const tabRegister = document.getElementById("tabRegister");
    const loginForm = document.getElementById("loginForm");
    const registerForm = document.getElementById("registerForm");

    function setTab(which){
      const login = which === "login";
      tabLogin.classList.toggle("active", login);
      tabRegister.classList.toggle("active", !login);
      loginForm.style.display = login ? "" : "none";
      registerForm.style.display = login ? "none" : "";
    }
    tabLogin.addEventListener("click", () => setTab("login"));
    tabRegister.addEventListener("click", () => setTab("register"));

    // ===== supabase helpers
    async function waitForSB({ tries = 18, delay = 250 } = {}){
      for(let i=0;i<tries;i++){
        const sb = (window.supabaseClient || (window.ensureSupabaseClient && window.ensureSupabaseClient()) || null);
        if(sb) return sb;
        await new Promise(r => setTimeout(r, delay));
      }
      return null;
    }

    async function isPremiumActive(sb, userId){
      // expects your backend to store premium state in profiles (recommended)
      // profiles: { id uuid pk, is_premium boolean, premium_tier text, premium_active_until timestamptz }
      try{
        const { data, error } = await sb
          .from("profiles")
          .select("is_premium,premium_tier,premium_active_until")
          .eq("id", userId)
          .maybeSingle();
        if(error) throw error;

        const isPremium = !!data?.is_premium;
        const until = data?.premium_active_until ? new Date(data.premium_active_until) : null;
        const activeByDate = until ? (until.getTime() > Date.now()) : true; // if null, treat as active when is_premium=true
        return { ok: isPremium && activeByDate, tier: data?.premium_tier || "" };
      } catch(e){
        // If profiles table doesn't exist yet, don't lock out silently; show guidance.
        console.warn("Premium check failed:", e);
        return { ok: false, error: "premium_check_failed" };
      }
    }

    async function redirectAfterLogin(){
      // Only Premium subscribers are entitled to have an account
      // → route to dashboard.html if premium, else sign out and send user to premium
      const sb = await waitForSB();
      if(!sb){
        toast("Supabase not ready. Refresh the page.", "error");
        return;
      }

      const { data } = await sb.auth.getSession();
      const session = data?.session || null;
      if(!session) return;

      const userId = session.user?.id;
      const email = session.user?.email || "";

      const p = await isPremiumActive(sb, userId);
      if(p.ok){
        toast("Access granted. Redirecting…");
        window.location.href = "dashboard.html";
        return;
      }

      // Not premium → sign out and guide to Premium
      try{ await sb.auth.signOut(); } catch {}
      toast("Premium subscription required for account access.");
      openWA(buildMsg("Premium Access Request", {
        Email: email,
        Message: "Hello Larmah, I can’t access my account. I want to verify Premium / activate access. My Paystack reference is:"
      }));
      setTimeout(() => (window.location.href = "premium.html#pay"), 700);
    }

    document.addEventListener("DOMContentLoaded", async () => {
      // if user already has a session, enforce Premium gating
      redirectAfterLogin();
    });

    // ===== LOGIN
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const sb = await waitForSB();
      if(!sb){
        toast("Supabase not ready. Refresh the page.", "error");
        return;
      }

      const email = document.getElementById("loginEmail").value.trim();
      const password = document.getElementById("loginPassword").value;

      const btn = document.getElementById("loginBtn");
      btn.disabled = true;
      btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Signing in…';

      try{
        const { data, error } = await sb.auth.signInWithPassword({ email, password });
        if(error) throw error;

        // If email not confirmed, Supabase may still allow session depending on settings.
        // We keep UX guidance via resend button.
        toast("Signed in. Checking premium access…");
        await redirectAfterLogin();
      } catch(err){
        console.error(err);
        toast(err?.message || "Sign in failed");
      } finally {
        btn.disabled = false;
        btn.textContent = "Sign In";
      }
    });

    // ===== RESET PASSWORD
    document.getElementById("resetBtn").addEventListener("click", async () => {
      const sb = await waitForSB();
      if(!sb){
        toast("Supabase not ready. Refresh the page.", "error");
        return;
      }
      const email = document.getElementById("loginEmail").value.trim();
      if(!email){
        toast("Enter your email first.");
        return;
      }
      const btn = document.getElementById("resetBtn");
      btn.disabled = true;
      btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Sending…';
      try{
        // adjust redirect to your password reset page if you have one
        const redirectTo = `${location.origin}/auth.html`;
        const { error } = await sb.auth.resetPasswordForEmail(email, { redirectTo });
        if(error) throw error;
        toast("Password reset email sent. Check your inbox.");
      } catch(err){
        toast(err?.message || "Could not send reset email");
      } finally {
        btn.disabled = false;
        btn.innerHTML = '<i class="fa-solid fa-key"></i> Reset Password';
      }
    });

    // ===== RESEND VERIFICATION EMAIL
    document.getElementById("resendBtn").addEventListener("click", async () => {
      const sb = await waitForSB();
      if(!sb){
        toast("Supabase not ready. Refresh the page.", "error");
        return;
      }
      const email = document.getElementById("loginEmail").value.trim();
      if(!email){
        toast("Enter your email first.");
        return;
      }
      const btn = document.getElementById("resendBtn");
      btn.disabled = true;
      btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Sending…';

      try{
        const redirectTo = `${location.origin}/auth.html`;
        const { error } = await sb.auth.resend({
          type: "signup",
          email,
          options: { emailRedirectTo: redirectTo }
        });
        if(error) throw error;
        toast("Verification email sent. Check your inbox.");
      } catch(err){
        toast(err?.message || "Could not resend email");
      } finally{
        btn.disabled = false;
        btn.innerHTML = '<i class="fa-regular fa-envelope"></i> Resend Verification Email';
      }
    });

    // expose
    window.toggleMenu = toggleMenu;
    window.toggleTheme = toggleTheme;
  </script>
</body>
</html>
